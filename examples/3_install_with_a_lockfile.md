#¬†Install with a lockfile

A lockfile is a file generated by TRM to freeze the exact versions of the dependencies used at a specific moment in time.

When a package depends on other packages, those packages might also depend on other packages, and so on. All these versions can change over time. If you install the same package today and then again in six months, the ‚Äúlatest compatible versions‚Äù might be different, and that can lead to different behavior or even errors.

A lockfile guarantees that everyone installs the exact same versions, even if newer versions of dependencies exist.

Install without a lockfile:
- TRM picks the newest versions it finds within the declared version range
- Your coworker might get different versions
- Your test system might behave differently than production
- Things break unexpectedly

Install with a lockfile:
- Same versions
- Same dependencies
- Same behavior everywhere

## One version per system

Because of how the SAP system is built, the can't be more than one version of the same package in the same SAP system.
This, unfortunately, cannot be changed, and installs with lockfiles can be challenging if you have more than one package using the same dependency.

There's no way around it, if that's the case, you have to make comprimises and manual activities, like picking a version that works for all it's dependant.

## Generating a lockfile

Lockfiles are only useful with packages with dependencies, so I'll use the `@trmsamples/doc-demo` package we created earlier as an example.

I'll run 

```bash
trm lock <package name>
```

> üí° Tip: run this command inside of a folder so that when the file is generated you can easily locate it

<div style="display:flex; justify-content:center;">
  <img src="/_media/3_1_install_with_a_lockfile.png" alt="Generating the lockfile" style="max-width:100%; height:auto; border-radius:8px;">
</div>

Let's open the `trm-lock.json` file

<div style="display:flex; justify-content:center;">
  <img src="/_media/3_2_install_with_a_lockfile.png" alt="Generating the lockfile" style="max-width:100%; height:auto; border-radius:8px;">
</div>

As you can see, for the package `@trmsamples/doc-demo` TRM flatted all of its dependencies (in this case just one) and for each returned their exact version, registry address and integrity.

## Publish new version of dependency

I'll now publish version `1.0.1` of `@trmsamples/doc-utility` (the dependency used by `@trmsamples/doc-demo`).

The reason why I decide to publish `1.0.1` is quite important for this demo: `@trmsamples/doc-demo` wants `@trmsamples/doc-utility` as a dependency with the version range `^1.0.0`, meaning that once i publish `1.0.1`, when an end user installs `@trmsamples/doc-demo` version `1.0.2` they would install `@trmsamples/doc-utility` version `1.0.1`, as it's the latest in range.

<div style="display:flex; justify-content:center;">
  <img src="/_media/3_3_install_with_a_lockfile.png" alt="Publishing a new release of the package" style="max-width:100%; height:auto; border-radius:8px;">
</div>

Let's confirm this by installing `@trmsamples/doc-demo` in a fresh instance.

<div style="display:flex; justify-content:center;">
  <img src="/_media/3_4_install_with_a_lockfile.png" alt="Publishing a new release of the package" style="max-width:100%; height:auto; border-radius:8px;">
</div>

As you can see, it shows that it's ready to install `1.0.1`, as it's the latest in range `^1.0.0`.

## Install

To really replicate the exact state of `@trmsamples/doc-demo` when the lockfile was generated, we need to install it with the lockfile!

Let's run the clean install command

```bash
trm clean-install <package name>
```

<div style="display:flex; justify-content:center;">
  <img src="/_media/3_5_install_with_a_lockfile.png" alt="Publishing a new release of the package" style="max-width:100%; height:auto; border-radius:8px;">
</div>

As you can see, it installed version `1.0.0` of `@trmsamples/doc-utility` as that's the one used at the time the lock file was generated.
Behind the scenes, it also verified that the integrity from the registry matched the integrity in the lockfile, to assure the release was identical.